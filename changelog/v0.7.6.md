# v0.7.6

CLI rename and live config reload.

## Why

LLMs consistently confused `ssh-hub refresh` (update server configs) with `ssh-hub update` (self-update binary). They'd call `update` expecting to change a server's host or port, then get a cargo install instead. Renaming the commands to match LLM expectations eliminates this class of tool-call errors.

Separately, changing server configs (host, port, identity) required killing and restarting every running MCP server to pick up the new values. This was a friction point in ephemeral environments where IPs change frequently — you'd update the config from a terminal, then have to restart the MCP process before the LLM session could use the new address.

## Changes

### CLI rename

- **`refresh` → `update`** — `ssh-hub update <server>` now updates server metadata and connection settings. Same functionality, name that LLMs expect.

- **`update` → `upgrade`** — `ssh-hub upgrade` now handles self-updating the binary. Disambiguates from server config updates.

```bash
# Before
ssh-hub refresh staging --host 10.0.0.99
ssh-hub update          # self-update binary

# After
ssh-hub update staging --host 10.0.0.99
ssh-hub upgrade         # self-update binary
```

### Live config reload

- **MCP servers auto-reload config on change** — every tool call checks the config file's mtime (single `stat()` syscall). When it differs from the last-known value, the registry is reloaded from disk. Only connections whose config actually changed are evicted and cleanly disconnected (`SSH_MSG_DISCONNECT`), preventing ghost `sshd` processes. Unchanged connections are untouched.

- **Targeted eviction** — compares old and new config entries field-by-field (host, user, port, remote_path, identity, auth). Metadata-only changes don't trigger reconnection. Removed servers are evicted. New servers are picked up on first use.

```rust
// server.rs — called at the top of every tool handler
async fn maybe_reload_config(&self) {
    // stat() → compare mtime → reload if changed → diff entries → evict stale connections
}
```

- **`disconnect()` exposed on `SshConnection`** — renamed from `force_disconnect` (more accurate semantics). Sends `SSH_MSG_DISCONNECT` with a 2s timeout so remote `sshd` cleans up immediately.

### Architecture

- **Config diffing moved to `ServerRegistry`** — `changed_servers()` and `connection_fields_changed()` are now associated methods on `ServerRegistry`/`ServerEntry` where they belong, rather than free functions in `server.rs`.

- **File I/O extracted to `connection/file_ops.rs`** — `read_file`, `write_file`, `glob` and their raw variants moved from `session.rs` (was 557 lines) into a separate `impl SshConnection` block. `session.rs` now focuses on SSH session lifecycle (463 lines), `file_ops.rs` on convenience wrappers (105 lines).
