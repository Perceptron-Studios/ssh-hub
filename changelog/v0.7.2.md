# v0.7.2

System metadata and LLM-facing documentation.

## Why

LLMs using ssh-hub generate shell commands blind — they don't know if a server runs Ubuntu (apt) or RHEL (dnf), x86 or ARM, bash or zsh. Wrong assumptions lead to failed commands and wasted tool calls. This release adds system metadata collection so the `list_servers` MCP tool tells the LLM what it's working with before it starts generating commands.

Separately, when MCP connections fail (wrong IP after a VM reboot, missing server), the LLM had no way to self-recover — it could only report the error. The new `--help` output gives agents a direct path to fix connection issues via the CLI.

## Changes

### System metadata

- **`ssh-hub refresh` command** — connects to a server, runs a POSIX shell snippet to collect OS, distro, arch, shell, and package manager, then stores the result in `servers.toml`. Diffs against previously stored values and reports changes. Supports `--all` to refresh every configured server in one pass.

- **`ssh-hub refresh` updates connection settings** — flags like `--host`, `--port`, `--remote-path`, and `--identity` are saved to config before connecting. Designed for ephemeral networks (cloud VMs, spot instances) where the server IP changes between sessions.

```bash
# VM got a new IP after reboot
ssh-hub refresh staging --host 10.0.0.99
```

- **Metadata collected on `ssh-hub add`** — after a successful connection test, metadata is collected automatically so the server is ready for LLM use without a separate `refresh` step.

- **Condensed `list_servers` MCP output** — replaced the split `connected`/`configured` arrays with a single flat list. Connection state grouped under a `connectivity` object (`status`, `reachable`, `latency_ms`), system info under `metadata` (without the internal `collected_at` timestamp). Dropped `auth` field (doesn't affect LLM behavior). Roughly halves the payload for active servers.

- **Metadata in `ssh-hub list` CLI** — each server shows a summary line below the connection details:

```
  staging -> deploy@staging.example.com:22 (path: /var/www, auth: auto)
    Ubuntu 22.04.3 LTS | x86_64 | apt
```

### CLI help for agents

- **Comprehensive `--help` output** — every subcommand now has expanded descriptions, connection string format references, and usage examples. The top-level help includes an `AGENTS` section that tells LLMs exactly which commands to run when MCP connections fail.

- **MCP server instructions reference the CLI** — the server instructions now include a one-liner pointing to `ssh-hub --help`, giving LLMs on-demand access to the full CLI documentation without bloating the MCP context window.

### Code quality

- **`Display` impl on `AuthMethod`** — replaces `format!("{:?}", auth).to_lowercase()` with a proper `Display` implementation.
- **Extracted `prompt_save_on_failure`** — connection failure path in `ssh-hub add` pulled into its own function for clarity.
- **Data-driven metadata diff** — uses an array of `(name, old, new)` tuples instead of repetitive per-field comparisons.
